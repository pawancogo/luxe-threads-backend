<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LuxeThreads Admin - <%= content_for?(:title) ? yield(:title) : "Dashboard" %></title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- daterangepicker CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #f8f9fa;
      }
      
      /* Header */
      .admin-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #fff;
        border-bottom: 1px solid #dee2e6;
        height: 60px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        z-index: 1030;
      }
      
      .admin-header .company-name {
        font-size: 1.25rem;
        font-weight: 600;
        color: #212529;
      }
      
      /* Profile Dropdown Styles */
      .profile-dropdown-btn {
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        border: none !important;
        position: relative;
      }
      
      .profile-dropdown-btn:hover {
        background-color: #f8f9fa !important;
        transform: translateY(-1px);
      }
      
      .profile-dropdown-btn:focus {
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
      }
      
      .profile-dropdown-btn::after {
        display: none; /* Hide Bootstrap's default arrow */
      }
      
      .profile-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        flex-shrink: 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
      }
      
      .profile-avatar-lg {
        width: 48px;
        height: 48px;
        font-size: 1.125rem;
      }
      
      .profile-dropdown-btn:hover .profile-avatar {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }
      
      .profile-info {
        min-width: 0; /* Allow text truncation */
      }
      
      .profile-name {
        font-weight: 600;
        font-size: 0.9375rem;
        color: #212529;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 150px;
      }
      
      .profile-email {
        font-size: 0.75rem;
        color: #6c757d;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 150px;
        margin-top: 2px;
      }
      
      .profile-arrow {
        font-size: 0.75rem;
        color: #6c757d;
        transition: transform 0.2s ease;
        margin-left: 0.25rem;
        flex-shrink: 0;
      }
      
      .profile-dropdown-btn[aria-expanded="true"] .profile-arrow {
        transform: rotate(180deg);
      }
      
      .profile-dropdown-menu {
        min-width: 280px;
        padding: 0;
        margin-top: 0.5rem !important;
        border-radius: 0.5rem;
        overflow: hidden;
      }
      
      .profile-dropdown-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-bottom: 1px solid #dee2e6;
      }
      
      .profile-menu-item {
        padding: 0.625rem 1rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
      }
      
      .profile-menu-item:hover {
        background-color: #f8f9fa;
        padding-left: 1.25rem;
      }
      
      .profile-menu-item i {
        width: 20px;
        text-align: center;
      }
      
      .profile-menu-item.text-danger:hover {
        background-color: #fff5f5;
        color: #dc3545 !important;
      }
      
      /* Sidebar */
      .admin-sidebar {
        position: fixed;
        left: 0;
        top: 60px;
        width: 250px;
        height: calc(100vh - 60px);
        background: #fff;
        border-right: 1px solid #dee2e6;
        overflow-y: auto;
        z-index: 1000;
      }
      
      .admin-sidebar .nav-link {
        color: #495057;
        padding: 0.75rem 1.25rem;
        border-left: 3px solid transparent;
        transition: all 0.2s;
      }
      
      .admin-sidebar .nav-link:hover {
        background-color: #f8f9fa;
        color: #0d6efd;
        border-left-color: #0d6efd;
      }
      
      .admin-sidebar .nav-link.active {
        background-color: #e7f1ff;
        color: #0d6efd;
        border-left-color: #0d6efd;
        font-weight: 500;
      }
      
      .admin-sidebar .nav-link i {
        width: 20px;
        margin-right: 0.75rem;
      }
      
      .admin-sidebar .nav-section {
        padding: 1rem 1.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        color: #6c757d;
        letter-spacing: 0.5px;
      }
      
      /* Subnav */
      .subnav {
        padding-left: 2rem;
        background-color: #f8f9fa;
      }
      
      .subnav .nav-link {
        padding: 0.5rem 1.25rem;
        font-size: 0.9rem;
      }
      
      /* Main Content */
      .admin-content {
        margin-left: 250px;
        margin-top: 60px;
        padding: 2rem;
        min-height: calc(100vh - 60px);
      }
      
      /* Admin Card */
      .admin-card {
        background: #fff;
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
      
      .admin-card .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #212529;
        margin-bottom: 0;
      }
      
      /* Table Styling */
      .table {
        margin-bottom: 0;
      }
      
      .table thead th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
        color: #495057;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        padding: 1rem 0.75rem;
      }
      
      .table tbody td {
        padding: 1rem 0.75rem;
        vertical-align: middle;
      }
      
      .table tbody tr:hover {
        background-color: #f8f9fa;
      }
      
      /* Flash Messages */
      .flash-messages {
        position: fixed;
        top: 70px;
        right: 2rem;
        z-index: 1050;
        max-width: 400px;
      }
      
      /* Responsive */
      @media (max-width: 768px) {
        .admin-sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s;
        }
        
        .admin-sidebar.show {
          transform: translateX(0);
        }
        
        .admin-content {
          margin-left: 0;
        }
      }
    </style>
  </head>

  <body data-admin-active="<%= current_admin&.is_active ? 'true' : 'false' %>" 
        data-admin-email-verified="<%= current_admin&.email_verified? ? 'true' : 'false' %>"
        data-admin-id="<%= current_admin&.id %>"
        data-admin-email="<%= current_admin&.email %>">
    <!-- Header -->
    <header class="admin-header">
      <div class="container-fluid h-100">
        <div class="d-flex align-items-center justify-content-between h-100">
          <!-- Company Name -->
          <div class="d-flex align-items-center">
            <button class="btn btn-link d-md-none me-2" id="sidebarToggle" type="button">
              <i class="fas fa-bars"></i>
            </button>
            <span class="company-name">LuxeThreads</span>
          </div>
          
          <!-- Right Menu -->
          <div class="d-flex align-items-center gap-3">
            <!-- Profile Dropdown -->
            <div class="dropdown">
              <button class="profile-dropdown-btn btn btn-link text-dark text-decoration-none dropdown-toggle d-flex align-items-center gap-2" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="<%= current_admin&.full_name || current_admin&.email || "Admin" %>">
                <!-- Avatar with Initials -->
                <div class="profile-avatar">
                  <% if current_admin&.first_name && current_admin&.last_name %>
                    <%= current_admin.first_name.first.upcase %><%= current_admin.last_name.first.upcase %>
                  <% elsif current_admin&.email %>
                    <%= current_admin.email.first.upcase %>
                  <% else %>
                    A
                  <% end %>
                </div>
                <!-- Name and Email -->
                <div class="d-flex flex-column align-items-start profile-info">
                  <span class="profile-name"><%= current_admin&.full_name || "Admin" %></span>
                  <% if current_admin&.email %>
                    <small class="profile-email"><%= current_admin.email %></small>
                  <% end %>
                </div>
                <!-- Dropdown Arrow -->
                <i class="fas fa-chevron-down profile-arrow"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end profile-dropdown-menu shadow-lg border-0">
                <li>
                  <%= link_to admin_dashboard_path, class: "dropdown-item profile-menu-item" do %>
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                  <% end %>
                </li>
                <li>
                  <%= link_to admin_admin_path(current_admin), class: "dropdown-item profile-menu-item" do %>
                    <i class="fas fa-user me-2"></i>My Profile
                  <% end %>
                </li>
                <% if super_admin? %>
                  <li>
                    <%= link_to rails_admin_path, class: "dropdown-item profile-menu-item", target: "_blank" do %>
                      <i class="fas fa-database me-2"></i>RailsAdmin
                    <% end %>
                  </li>
                <% end %>
                <li><hr class="dropdown-divider my-2"></li>
                <li>
                  <%= link_to admin_logout_path, method: :delete, class: "dropdown-item profile-menu-item text-danger" do %>
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  <% end %>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
      <nav class="nav flex-column py-2">
        <% 
          # Get dynamic navigation items organized by section
          nav_sections = navigation_items
          current_controller = controller_name_without_namespace
        %>
        
        <% nav_sections.each do |section_name, items| %>
          <% if section_name.present? && section_name != 'Other' %>
            <li class="nav-section"><%= section_name %></li>
          <% end %>
          
          <% items.each do |item| %>
            <% 
              # Use controller_name from item if available, otherwise use key
              item_controller = item[:controller_name].presence || item[:key].to_s
              is_active = current_controller == item_controller || 
                          (item_controller == 'dashboard' && current_controller == 'dashboard')
              path_method = item[:path]
            %>
            <li class="nav-item">
              <%= link_to send(path_method), class: "nav-link #{'active' if is_active}" do %>
                <i class="<%= item[:icon] %>"></i><%= item[:label] %>
              <% end %>
            </li>
          <% end %>
        <% end %>
      </nav>
    </aside>

    <!-- Flash Messages -->
    <div class="flash-messages">
      <% if notice %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="fas fa-check-circle me-2"></i><%= notice %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% end %>
      
      <% if alert %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="fas fa-exclamation-circle me-2"></i><%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% end %>
    </div>

    <!-- Main Content -->
    <main class="admin-content">
      <%= yield %>
    </main>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Searchable Dropdown Component -->
    <script>
      // Searchable Dropdown with Infinite Scroll
      // Shows max 10 items at a time, loads more on scroll
      class SearchableDropdown {
        constructor(selectElement, options = {}) {
          this.select = selectElement;
          this.options = {
            maxItems: options.maxItems || 10,
            loadMoreOnScroll: options.loadMoreOnScroll !== false,
            searchPlaceholder: options.searchPlaceholder || 'Search...',
            ...options
          };
          
          this.allOptions = [];
          this.filteredOptions = [];
          this.displayedCount = this.options.maxItems;
          this.isLoading = false;
          
          this.init();
        }
        
        init() {
          // Store all options from the select element
          this.allOptions = Array.from(this.select.options).map(option => ({
            value: option.value,
            text: option.text,
            selected: option.selected
          }));
          
          // Hide original select
          this.select.style.display = 'none';
          
          // Create custom dropdown
          this.createDropdown();
          this.filteredOptions = this.allOptions;
          this.renderOptions();
        }
        
        createDropdown() {
          const wrapper = document.createElement('div');
          wrapper.className = 'searchable-dropdown-wrapper';
          wrapper.style.position = 'relative';
          
          // Create input field for search
          const searchInput = document.createElement('input');
          searchInput.type = 'text';
          searchInput.className = 'form-control searchable-dropdown-search';
          searchInput.placeholder = this.options.searchPlaceholder;
          searchInput.style.marginBottom = '5px';
          
          // Create dropdown container
          const dropdown = document.createElement('div');
          dropdown.className = 'searchable-dropdown-list';
          dropdown.style.cssText = 'position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ced4da; border-radius: 0.375rem; max-height: 300px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);';
          
          // Create selected value display
          const selectedDisplay = document.createElement('button');
          selectedDisplay.type = 'button';
          selectedDisplay.className = 'form-select searchable-dropdown-display';
          selectedDisplay.style.textAlign = 'left';
          selectedDisplay.innerHTML = this.select.options[this.select.selectedIndex]?.text || 'Select...';
          selectedDisplay.addEventListener('click', (e) => {
            e.preventDefault();
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            if (dropdown.style.display === 'block') {
              searchInput.focus();
            }
          });
          
          // Search functionality
          searchInput.addEventListener('input', (e) => {
            this.filterOptions(e.target.value);
          });
          
          // Close dropdown when clicking outside
          document.addEventListener('click', (e) => {
            if (!wrapper.contains(e.target)) {
              dropdown.style.display = 'none';
            }
          });
          
          wrapper.appendChild(selectedDisplay);
          wrapper.appendChild(dropdown);
          dropdown.appendChild(searchInput);
          
          const optionsContainer = document.createElement('div');
          optionsContainer.className = 'searchable-dropdown-options';
          dropdown.appendChild(optionsContainer);
          
          this.wrapper = wrapper;
          this.searchInput = searchInput;
          this.dropdown = dropdown;
          this.optionsContainer = optionsContainer;
          this.selectedDisplay = selectedDisplay;
          
          // Insert wrapper after select
          this.select.parentNode.insertBefore(wrapper, this.select.nextSibling);
          
          // Scroll handler for infinite scroll
          if (this.options.loadMoreOnScroll) {
            dropdown.addEventListener('scroll', () => {
              if (this.isLoading) return;
              
              const scrollTop = dropdown.scrollTop;
              const scrollHeight = dropdown.scrollHeight;
              const clientHeight = dropdown.clientHeight;
              
              // Load more when near bottom (within 50px)
              if (scrollHeight - scrollTop - clientHeight < 50) {
                this.loadMore();
              }
            });
          }
        }
        
        filterOptions(searchTerm) {
          const term = searchTerm.toLowerCase();
          this.filteredOptions = this.allOptions.filter(option => 
            option.text.toLowerCase().includes(term) || option.value.toLowerCase().includes(term)
          );
          this.displayedCount = this.options.maxItems;
          this.renderOptions();
        }
        
        renderOptions() {
          this.optionsContainer.innerHTML = '';
          
          const optionsToShow = this.filteredOptions.slice(0, this.displayedCount);
          
          if (optionsToShow.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'p-2 text-muted text-center';
            noResults.textContent = 'No results found';
            this.optionsContainer.appendChild(noResults);
            return;
          }
          
          optionsToShow.forEach(option => {
            const optionElement = document.createElement('div');
            optionElement.className = 'searchable-dropdown-option p-2';
            optionElement.style.cssText = 'cursor: pointer; border-bottom: 1px solid #f0f0f0;';
            optionElement.textContent = option.text;
            
            if (option.selected) {
              optionElement.style.backgroundColor = '#e7f3ff';
              optionElement.style.fontWeight = 'bold';
            }
            
            optionElement.addEventListener('mouseenter', () => {
              optionElement.style.backgroundColor = '#f8f9fa';
            });
            
            optionElement.addEventListener('mouseleave', () => {
              optionElement.style.backgroundColor = option.selected ? '#e7f3ff' : 'transparent';
            });
            
            optionElement.addEventListener('click', () => {
              this.selectOption(option.value, option.text);
            });
            
            this.optionsContainer.appendChild(optionElement);
          });
          
          // Show "Load more" indicator if there are more items
          if (this.filteredOptions.length > this.displayedCount) {
            const loadMore = document.createElement('div');
            loadMore.className = 'p-2 text-center text-muted';
            loadMore.style.cssText = 'font-size: 0.875rem; border-top: 1px solid #f0f0f0;';
            loadMore.textContent = `Scroll for more (${this.filteredOptions.length - this.displayedCount} remaining)`;
            this.optionsContainer.appendChild(loadMore);
          }
        }
        
        loadMore() {
          if (this.displayedCount >= this.filteredOptions.length) return;
          
          this.isLoading = true;
          this.displayedCount += this.options.maxItems;
          this.renderOptions();
          this.isLoading = false;
        }
        
        selectOption(value, text) {
          this.select.value = value;
          this.selectedDisplay.textContent = text;
          this.dropdown.style.display = 'none';
          this.searchInput.value = '';
          
          // Trigger change event on original select
          const event = new Event('change', { bubbles: true });
          this.select.dispatchEvent(event);
        }
      }
      
      // Initialize searchable dropdowns on page load
      document.addEventListener('DOMContentLoaded', function() {
        // Find all selects with data-searchable="true"
        document.querySelectorAll('select[data-searchable="true"]').forEach(select => {
          const maxItems = parseInt(select.dataset.maxItems) || 10;
          
          // Only initialize if there are more than maxItems options
          if (select.options.length > maxItems) {
            new SearchableDropdown(select, {
              maxItems: maxItems
            });
          }
        });
      });
    </script>
    <script>
      // Sidebar toggle for mobile
      document.getElementById('sidebarToggle')?.addEventListener('click', function() {
        document.getElementById('adminSidebar').classList.toggle('show');
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        const sidebar = document.getElementById('adminSidebar');
        const toggle = document.getElementById('sidebarToggle');
        if (window.innerWidth <= 768 && 
            sidebar && 
            !sidebar.contains(event.target) && 
            toggle && 
            !toggle.contains(event.target)) {
          sidebar.classList.remove('show');
        }
      });
    </script>
    
    <!-- Inactive Account Blocker Overlay -->
    <div id="inactiveAccountOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
      <div style="background: white; padding: 2rem; border-radius: 0.5rem; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <div style="font-size: 3rem; color: #ffc107; margin-bottom: 1rem;">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 style="margin-bottom: 1rem; color: #212529;">Account Verification Required</h3>
        <p style="margin-bottom: 1.5rem; color: #6c757d;">Your account is inactive. Please verify your email to activate your account.</p>
        <button type="button" class="btn btn-primary btn-lg" onclick="redirectToVerification()" style="min-width: 200px;">
          <i class="fas fa-envelope me-2"></i>Verify Account
        </button>
      </div>
    </div>

    <!-- Verification Modal for Inactive Accounts -->
    <div class="modal fade" id="inactiveAccountModal" tabindex="-1" aria-labelledby="inactiveAccountModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-warning text-dark">
            <h5 class="modal-title" id="inactiveAccountModalLabel">
              <i class="fas fa-exclamation-triangle me-2"></i>Account Verification Required
            </h5>
          </div>
          <div class="modal-body">
            <p class="mb-3">Your account is inactive. Please verify your email to activate your account.</p>
            <p class="text-muted small mb-0">You will be redirected to the verification page.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="redirectToVerification()">
              <i class="fas fa-envelope me-2"></i>Verify Account
            </button>
          </div>
        </div>
      </div>
    </div>

    <% if session[:show_inactive_modal] && session[:verification_url] %>
      <div id="inactive-account-data" 
           data-verification-url="<%= session[:verification_url] %>" 
           style="display: none;"></div>
      <% session.delete(:show_inactive_modal) %>
      <% @verification_url = session.delete(:verification_url) %>
    <% end %>

    <script>
      // Check for inactive account and show modal
      function checkInactiveAccount() {
        // Check if we're already on verification page
        if (window.location.pathname.includes('verify-email')) {
          return;
        }
        
        const body = document.body;
        const isActive = body.getAttribute('data-admin-active') === 'true';
        const emailVerified = body.getAttribute('data-admin-email-verified') === 'true';
        const adminId = body.getAttribute('data-admin-id');
        const adminEmail = body.getAttribute('data-admin-email');
        
        // Check if admin is inactive - show verification modal to reactivate
        // When deactivated, email_verified is reset to false, so they need to verify again
        if (!isActive && adminId && adminEmail) {
          const verificationUrl = `/verify-email?type=admin&id=${adminId}&email=${encodeURIComponent(adminEmail)}&reason=inactive`;
          showInactiveModal(verificationUrl);
          return;
        }
        
        // Also check for inactive account data from session (fallback)
        const inactiveData = document.getElementById('inactive-account-data');
        if (inactiveData) {
          const verificationUrl = inactiveData.getAttribute('data-verification-url');
          if (verificationUrl) {
            showInactiveModal(verificationUrl);
          }
        }
      }
      
      function showInactiveModal(verificationUrl) {
        // Store verification URL
        window.verificationUrl = verificationUrl;
        
        // Show overlay immediately (works even if Bootstrap isn't loaded)
        const overlay = document.getElementById('inactiveAccountOverlay');
        if (overlay) {
          overlay.style.display = 'flex';
          overlay.style.alignItems = 'center';
          overlay.style.justifyContent = 'center';
          document.body.style.overflow = 'hidden';
          // Prevent any clicks on the overlay background
          overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
              e.preventDefault();
              e.stopPropagation();
            }
          });
        }
        
        // Also try to show Bootstrap modal if available
        const modalElement = document.getElementById('inactiveAccountModal');
        if (modalElement && typeof bootstrap !== 'undefined' && bootstrap.Modal) {
          try {
            const modal = new bootstrap.Modal(modalElement, {
              backdrop: 'static',
              keyboard: false
            });
            
            // Prevent closing the modal
            modalElement.addEventListener('hide.bs.modal', function(event) {
              event.preventDefault();
              return false;
            });
            
            // Show the modal
            modal.show();
          } catch (e) {
            console.error('Error showing Bootstrap modal:', e);
            // Overlay is already showing, so that's fine
          }
        }
      }
      
      function redirectToVerification() {
        if (window.verificationUrl) {
          window.location.href = window.verificationUrl;
        } else {
          // Fallback - construct URL
          window.location.href = '/verify-email?type=admin&reason=inactive';
        }
      }
      
      // Run check immediately and on page load
      // Check immediately (in case DOMContentLoaded already fired)
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkInactiveAccount);
      } else {
        // DOM already loaded, check immediately
        checkInactiveAccount();
      }
      
      // Also check after a short delay to ensure Bootstrap is loaded
      setTimeout(checkInactiveAccount, 100);
      
      // Check on every navigation (for SPA-like behavior)
      let lastUrl = location.href;
      new MutationObserver(() => {
        const url = location.href;
        if (url !== lastUrl) {
          lastUrl = url;
          setTimeout(checkInactiveAccount, 200);
        }
      }).observe(document, { subtree: true, childList: true });
      
      // Password toggle function - available globally
      function togglePassword(fieldId, buttonId) {
        const field = document.getElementById(fieldId);
        const button = document.getElementById(buttonId);
        const icon = button?.querySelector('i');
        
        if (field) {
          if (field.type === 'password') {
            field.type = 'text';
            if (icon) {
              icon.classList.remove('fa-eye');
              icon.classList.add('fa-eye-slash');
            }
          } else {
            field.type = 'password';
            if (icon) {
              icon.classList.remove('fa-eye-slash');
              icon.classList.add('fa-eye');
            }
          }
        }
      }
    </script>

    <!-- jQuery (required for daterangepicker) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Moment.js (required for daterangepicker) -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <!-- daterangepicker -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  </body>
</html>
