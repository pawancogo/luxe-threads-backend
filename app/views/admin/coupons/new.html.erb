<% content_for :title, "New Coupon" %>

<div class="admin-card">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="card-title mb-0">
      <i class="fas fa-plus me-2"></i>Create New Coupon
    </h1>
    <%= link_to "Back to Coupons", admin_coupons_path, class: "btn btn-outline-secondary" %>
  </div>
  
  <%= form_with model: [:admin, @coupon], local: true do |f| %>
    <% if @coupon.errors.any? %>
      <div class="alert alert-danger">
        <h5>Please fix the following errors:</h5>
        <ul class="mb-0">
          <% @coupon.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :code, "Coupon Code", class: "form-label" %>
          <%= f.text_field :code, class: "form-control font-mono", required: true, 
              placeholder: "SUMMER2025", style: "text-transform: uppercase;" %>
          <small class="form-text text-muted">Will be automatically converted to uppercase</small>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :coupon_type, class: "form-label" %>
          <%= f.select :coupon_type, 
              [['Percentage', 'percentage'], ['Fixed Amount', 'fixed_amount']],
              {}, { class: "form-select", required: true } %>
        </div>
      </div>
    </div>
    
    <div class="mb-3">
      <%= f.label :name, class: "form-label" %>
      <%= f.text_field :name, class: "form-control", required: true %>
    </div>
    
    <div class="mb-3">
      <%= f.label :description, class: "form-label" %>
      <%= f.text_area :description, rows: 3, class: "form-control" %>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :discount_value, class: "form-label" do %>
            Discount Value <span id="discount-label">(%)</span>
          <% end %>
          <%= f.number_field :discount_value, step: 0.01, class: "form-control", required: true %>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :max_discount_amount, "Maximum Discount (₹)", class: "form-label" %>
          <%= f.number_field :max_discount_amount, step: 0.01, class: "form-control" %>
          <small class="form-text text-muted">For percentage coupons only</small>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :min_order_amount, "Minimum Order Amount (₹)", class: "form-label" %>
          <%= f.number_field :min_order_amount, step: 0.01, value: @coupon.min_order_amount || 0, class: "form-control" %>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :max_uses, "Maximum Uses", class: "form-label" %>
          <%= f.number_field :max_uses, class: "form-control" %>
          <small class="form-text text-muted">Leave empty for unlimited</small>
        </div>
      </div>
    </div>
    
    <div class="mb-3">
      <%= f.label :max_uses_per_user, "Maximum Uses Per User", class: "form-label" %>
      <%= f.number_field :max_uses_per_user, class: "form-control" %>
      <small class="form-text text-muted">Leave empty for unlimited</small>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :valid_from, class: "form-label" %>
          <%= f.date_field :valid_from, class: "form-control", required: true %>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :valid_until, class: "form-label" %>
          <%= f.date_field :valid_until, class: "form-control", required: true %>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-4">
        <div class="mb-3">
          <div class="form-check">
            <%= f.check_box :is_active, class: "form-check-input", checked: true %>
            <%= f.label :is_active, "Active", class: "form-check-label" %>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="mb-3">
          <div class="form-check">
            <%= f.check_box :is_new_user_only, class: "form-check-input" %>
            <%= f.label :is_new_user_only, "New Users Only", class: "form-check-label" %>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="mb-3">
          <div class="form-check">
            <%= f.check_box :is_first_order_only, class: "form-check-input" %>
            <%= f.label :is_first_order_only, "First Order Only", class: "form-check-label" %>
          </div>
        </div>
      </div>
    </div>
    
    <div class="d-flex gap-2">
      <%= f.submit "Create Coupon", class: "btn btn-primary" %>
      <%= link_to "Cancel", admin_coupons_path, class: "btn btn-outline-secondary" %>
    </div>
  <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const couponType = document.getElementById('coupon_coupon_type');
  const discountLabel = document.getElementById('discount-label');
  const discountValue = document.getElementById('coupon_discount_value');
  
  if (couponType) {
    couponType.addEventListener('change', function() {
      if (this.value === 'percentage') {
        discountLabel.textContent = '(%)';
        discountValue.placeholder = '10';
      } else {
        discountLabel.textContent = '(₹)';
        discountValue.placeholder = '100';
      }
    });
  }
});
</script>

