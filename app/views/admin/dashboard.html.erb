<!DOCTYPE html>
<html lang="en">
<head>
  <title>LuxeThreads Admin Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta charset="utf-8">
  <meta name="csrf-token" content="<%= form_authenticity_token %>">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * {
      font-family: 'Inter', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      max-height: 100vh;
      overflow-y: auto;
      padding-top: 0;
    }
    
    .navbar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
    }
    
    .main-content {
      margin-top: 80px;
      padding: 0;
      min-height: calc(100vh - 80px);
      max-height: calc(100vh - 80px);
      overflow-y: auto;
    }
    
    @media (max-width: 768px) {
      .main-content {
        margin-top: 70px;
      }
    }
    
    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
    }
    
    .navbar-nav .nav-link {
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .navbar-nav .nav-link:hover {
      transform: translateY(-1px);
    }
    
    .dropdown-menu {
      border: none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border-radius: 12px;
      padding: 0.5rem 0;
    }
    
    .dropdown-item {
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateX(5px);
    }
    
    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      background: white;
      overflow: hidden;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.12);
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 16px;
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .stat-card .icon {
      font-size: 2.5rem;
      opacity: 0.8;
      margin-bottom: 1rem;
    }
    
    .stat-card .number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    
    .stat-card .label {
      font-size: 0.9rem;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 1px solid #dee2e6;
      padding: 1.5rem;
      font-weight: 600;
      color: #495057;
    }
    
    .table {
      margin-bottom: 0;
    }
    
    .table th {
      border-top: none;
      font-weight: 600;
      color: #495057;
      padding: 1rem 0.75rem;
    }
    
    .table td {
      padding: 0.75rem;
      vertical-align: middle;
    }
    
    .badge {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 500;
    }
    
    .btn {
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    }
    
    .btn-info {
      background: linear-gradient(135deg, #3498db 0%, #85c1e9 100%);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #f39c12 0%, #f7dc6f 100%);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #e74c3c 0%, #f1948a 100%);
    }
    
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
    }
    
    .toast {
      border: none;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      min-width: 300px;
    }
    
    .toast-success {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border-left: 4px solid #28a745;
    }
    
    .toast-danger {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      border-left: 4px solid #dc3545;
    }
    
    .toast-header {
      background: transparent;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      font-weight: 600;
    }
    
    .toast-body {
      padding: 1rem 1.25rem;
    }
    
    @media (max-width: 576px) {
      .toast-container {
        top: 80px;
        right: 10px;
        left: 10px;
      }
      
      .toast {
        min-width: auto;
        font-size: 0.9rem;
      }
      
      .toast-header {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }
      
      .toast-body {
        padding: 0.75rem 1rem;
      }
    }
    
    .quick-actions .btn {
      margin-bottom: 1rem;
      padding: 1rem;
      text-align: left;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    
    .quick-actions .btn i {
      margin-right: 0.75rem;
      font-size: 1.2rem;
    }
    
    .btn-group .btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
    }
    
    .btn-group .btn.active:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      border-color: #5a67d8;
    }
    
    /* Search Bar Styles */
    #admin-search-form {
      position: relative;
      flex: 1;
      max-width: 500px;
      margin: 0 1rem;
    }
    
    #admin-search-input {
      background: rgba(255, 255, 255, 0.15) !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
      color: white !important;
    }
    
    #admin-search-input::placeholder {
      color: rgba(255, 255, 255, 0.7) !important;
    }
    
    #admin-search-input:focus {
      background: rgba(255, 255, 255, 0.25) !important;
      border-color: rgba(255, 255, 255, 0.5) !important;
      color: white !important;
      box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25) !important;
    }
    
    #admin-search-form .btn-outline-light {
      border-color: rgba(255, 255, 255, 0.3) !important;
      color: white !important;
    }
    
    #admin-search-form .btn-outline-light:hover {
      background: rgba(255, 255, 255, 0.2) !important;
      border-color: rgba(255, 255, 255, 0.5) !important;
    }
    
    @media (max-width: 992px) {
      #admin-search-form {
        max-width: 100%;
        margin: 0.5rem 0;
        order: 3;
        width: 100%;
      }
    }
    
    #search-results {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      margin-top: 4px;
      padding: 0;
      min-width: 100%;
    }
    
    #search-results .dropdown-item {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.2s;
    }
    
    #search-results .dropdown-item:last-child {
      border-bottom: none;
    }
    
    #search-results .dropdown-item:hover {
      background-color: #f8f9fa;
    }
    
    #search-results .dropdown-item i {
      width: 20px;
      text-align: center;
    }
    
    .welcome-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .welcome-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 8s ease-in-out infinite;
    }
    
    .welcome-section h1 {
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }
    
    .welcome-section p {
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }
    
    @media (max-width: 768px) {
      .main-content {
        padding: 1rem;
      }
      
      .stat-card {
        margin-bottom: 1rem;
        padding: 1.5rem;
      }
      
      .stat-card .number {
        font-size: 2rem;
      }
      
      .welcome-section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      
      .welcome-section h1 {
        font-size: 1.5rem;
      }
      
      .quick-actions .btn {
        margin-bottom: 0.75rem;
        padding: 0.75rem;
        font-size: 0.9rem;
      }
      
      .card {
        margin-bottom: 1rem;
      }
      
      .table-responsive {
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 576px) {
      .main-content {
        padding: 0.5rem;
      }
      
      .stat-card {
        padding: 1.25rem;
        margin-bottom: 0.75rem;
      }
      
      .stat-card .number {
        font-size: 1.75rem;
      }
      
      .stat-card .icon {
        font-size: 2rem;
      }
      
      .welcome-section {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .welcome-section h1 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
      }
      
      .welcome-section p {
        font-size: 0.9rem;
      }
      
      .quick-actions .btn {
        margin-bottom: 0.5rem;
        padding: 0.75rem 0.5rem;
        font-size: 0.85rem;
      }
      
      .quick-actions .btn i {
        margin-right: 0.5rem;
        font-size: 1rem;
      }
      
      .card-header {
        padding: 1rem;
        font-size: 0.9rem;
      }
      
      .card-body {
        padding: 1rem;
      }
      
      .table-responsive {
        font-size: 0.8rem;
      }
      
      .table th,
      .table td {
        padding: 0.5rem 0.25rem;
      }
      
      .badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Admin Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/admin_auth/dashboard">
        <i class="fas fa-shield-alt me-2"></i>
        LuxeThreads Admin
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/admin_auth/dashboard">
              <i class="fas fa-tachometer-alt me-1"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin" target="_blank">
              <i class="fas fa-cog me-1"></i>RailsAdmin
            </a>
          </li>
        </ul>
        
        <!-- Search Bar -->
        <form class="d-flex" id="admin-search-form">
          <div class="input-group" style="position: relative;">
            <input type="text" 
                   class="form-control form-control-sm" 
                   id="admin-search-input" 
                   placeholder="Search orders, users, products..." 
                   autocomplete="off">
            <button class="btn btn-outline-light btn-sm" type="submit">
              <i class="fas fa-search"></i>
            </button>
            <div id="search-results" class="dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; max-height: 400px; overflow-y: auto; width: 100%;">
              <div id="search-results-content"></div>
            </div>
          </div>
        </form>
        
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" title="<%= @current_admin&.full_name || @current_admin&.email || "Admin" %>">
              <i class="fas fa-user-circle me-2"></i>
              <div class="d-flex flex-column align-items-start">
                <span class="fw-bold"><%= @current_admin&.full_name || "Admin" %></span>
                <% if @current_admin&.email %>
                  <small class="text-muted" style="font-size: 0.75rem;"><%= @current_admin.email %></small>
                <% end %>
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li class="px-3 py-2">
                <div class="d-flex flex-column">
                  <strong><%= @current_admin&.full_name || "Admin" %></strong>
                  <% if @current_admin&.email %>
                    <small class="text-muted"><%= @current_admin.email %></small>
                  <% end %>
                </div>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" href="/admin_auth/dashboard">
                  <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
              </li>
              <li>
                <%= link_to admin_admin_path(@current_admin), class: "dropdown-item" do %>
                  <i class="fas fa-user me-2"></i>My Profile
                <% end %>
              </li>
              <% if @current_admin&.super_admin? %>
                <li>
                  <a class="dropdown-item" href="/admin" target="_blank">
                    <i class="fas fa-database me-2"></i>RailsAdmin
                  </a>
                </li>
              <% end %>
              <li><hr class="dropdown-divider"></li>
              <li>
                <%= link_to admin_logout_path, method: :delete, class: "dropdown-item text-danger", confirm: "Are you sure you want to logout?" do %>
                  <i class="fas fa-sign-out-alt me-2"></i>Logout
                <% end %>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <!-- Main Content -->
  <div class="main-content">
    <div class="container-fluid py-4">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="mb-2">
            <i class="fas fa-tachometer-alt me-2"></i>
            Welcome back, <%= @current_admin.first_name %>!
          </h1>
          <p class="mb-0">Here's what's happening with your LuxeThreads platform today.</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="d-flex gap-2">
            <% if @current_admin&.super_admin? %>
              <a href="/admin" class="btn btn-light" target="_blank">
                <i class="fas fa-database me-1"></i>RailsAdmin
              </a>
            <% end %>
            <%= link_to admin_logout_path, method: :delete, class: "btn btn-outline-light", confirm: "Are you sure you want to logout?" do %>
              <i class="fas fa-sign-out-alt me-1"></i>Logout
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification Alerts Section -->
    <% if @pending_orders_count > 0 || @pending_products_count > 0 || @low_stock_variants_count > 0 || @out_of_stock_variants_count > 0 %>
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-warning" style="background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-width: 2px !important;">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-bell text-warning me-2" style="font-size: 1.5rem;"></i>
              <h5 class="mb-0">Action Required</h5>
            </div>
            <div class="row g-3">
              <% if @pending_orders_count > 0 %>
              <div class="col-md-3 col-sm-6">
                <div class="alert alert-warning mb-0 d-flex align-items-center justify-content-between">
                  <div>
                    <strong><%= @pending_orders_count %></strong>
                    <small class="d-block">Pending Orders</small>
                  </div>
                  <%= link_to admin_orders_path(status: 'pending'), class: "btn btn-sm btn-warning" do %>
                    <i class="fas fa-arrow-right"></i>
                  <% end %>
                </div>
              </div>
              <% end %>
              
              <% if @pending_products_count > 0 %>
              <div class="col-md-3 col-sm-6">
                <div class="alert alert-info mb-0 d-flex align-items-center justify-content-between">
                  <div>
                    <strong><%= @pending_products_count %></strong>
                    <small class="d-block">Pending Products</small>
                  </div>
                  <%= link_to admin_products_path(status: 'pending'), class: "btn btn-sm btn-info" do %>
                    <i class="fas fa-arrow-right"></i>
                  <% end %>
                </div>
              </div>
              <% end %>
              
              <% if @low_stock_variants_count > 0 %>
              <div class="col-md-3 col-sm-6">
                <div class="alert alert-warning mb-0 d-flex align-items-center justify-content-between">
                  <div>
                    <strong><%= @low_stock_variants_count %></strong>
                    <small class="d-block">Low Stock Items</small>
                  </div>
                  <%= link_to admin_products_path, class: "btn btn-sm btn-warning" do %>
                    <i class="fas fa-arrow-right"></i>
                  <% end %>
                </div>
              </div>
              <% end %>
              
              <% if @out_of_stock_variants_count > 0 %>
              <div class="col-md-3 col-sm-6">
                <div class="alert alert-danger mb-0 d-flex align-items-center justify-content-between">
                  <div>
                    <strong><%= @out_of_stock_variants_count %></strong>
                    <small class="d-block">Out of Stock</small>
                  </div>
                  <%= link_to admin_products_path, class: "btn btn-sm btn-danger" do %>
                    <i class="fas fa-arrow-right"></i>
                  <% end %>
                </div>
              </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Stats Cards -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @users_count %></div>
              <div class="label">Total Users</div>
            </div>
            <div class="icon">
              <i class="fas fa-users"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @suppliers_count %></div>
              <div class="label">Total Suppliers</div>
            </div>
            <div class="icon">
              <i class="fas fa-store"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @products_count %></div>
              <div class="label">Total Products</div>
            </div>
            <div class="icon">
              <i class="fas fa-box"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @orders_count %></div>
              <div class="label">Total Orders</div>
            </div>
            <div class="icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Phase 2: Additional Stats Row -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @active_products_count %></div>
              <div class="label">Active Products</div>
            </div>
            <div class="icon">
              <i class="fas fa-check-circle text-success"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @featured_products_count %></div>
              <div class="label">Featured Products</div>
            </div>
            <div class="icon">
              <i class="fas fa-star text-warning"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @low_stock_variants_count %></div>
              <div class="label">Low Stock Variants</div>
            </div>
            <div class="icon">
              <i class="fas fa-exclamation-triangle text-warning"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
          <div class="d-flex align-items-center">
            <div class="flex-grow-1">
              <div class="number"><%= @categories_count %></div>
              <div class="label">Categories</div>
            </div>
            <div class="icon">
              <i class="fas fa-tags"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Revenue Metrics Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-chart-line me-2"></i>
              Revenue Metrics
            </h5>
            <div class="d-flex gap-2 align-items-center flex-wrap">
              <!-- Quick Filter Buttons -->
              <div class="btn-group btn-group-sm" role="group">
                <a href="<%= admin_dashboard_path(start_date: 7.days.ago.to_date, end_date: Date.current) %>" 
                   class="btn btn-outline-primary <%= 'active' if (@end_date - @start_date).to_i == 7 %>">
                  Last 7 Days
                </a>
                <a href="<%= admin_dashboard_path(start_date: 30.days.ago.to_date, end_date: Date.current) %>" 
                   class="btn btn-outline-primary <%= 'active' if (@end_date - @start_date).to_i == 30 %>">
                  Last 30 Days
                </a>
                <a href="<%= admin_dashboard_path(start_date: 90.days.ago.to_date, end_date: Date.current) %>" 
                   class="btn btn-outline-primary <%= 'active' if (@end_date - @start_date).to_i == 90 %>">
                  Last 90 Days
                </a>
              </div>
              
              <!-- Custom Date Range -->
              <form method="get" action="<%= admin_dashboard_path %>" class="d-flex gap-2">
                <input type="date" name="start_date" value="<%= @start_date %>" class="form-control form-control-sm" style="width: auto;" placeholder="Start Date">
                <span class="align-self-center">to</span>
                <input type="date" name="end_date" value="<%= @end_date %>" class="form-control form-control-sm" style="width: auto;" placeholder="End Date">
                <button type="submit" class="btn btn-sm btn-primary">
                  <i class="fas fa-filter me-1"></i>Custom
                </button>
              </form>
            </div>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                  <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                      <div class="number" style="color: white; font-size: 2.5rem;">
                        ₹<%= number_with_delimiter(@revenue_metrics[:total_revenue]) %>
                      </div>
                      <div class="label" style="color: rgba(255,255,255,0.9);">Total Revenue</div>
                      <small style="color: rgba(255,255,255,0.8);">
                        <%= @revenue_metrics[:total_orders] %> orders
                      </small>
                    </div>
                    <div class="icon">
                      <i class="fas fa-rupee-sign" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                  <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                      <div class="number" style="color: white; font-size: 2.5rem;">
                        ₹<%= number_with_delimiter(@revenue_metrics[:average_order_value]) %>
                      </div>
                      <div class="label" style="color: rgba(255,255,255,0.9);">Average Order Value</div>
                      <small style="color: rgba(255,255,255,0.8);">
                        Per order
                      </small>
                    </div>
                    <div class="icon">
                      <i class="fas fa-chart-bar" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                  <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                      <div class="number" style="color: white; font-size: 2.5rem;">
                        <%= @revenue_metrics[:total_orders] %>
                      </div>
                      <div class="label" style="color: rgba(255,255,255,0.9);">Completed Orders</div>
                      <small style="color: rgba(255,255,255,0.8);">
                        Paid/Shipped/Delivered
                      </small>
                    </div>
                    <div class="icon">
                      <i class="fas fa-check-circle" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Charts Section -->
            <div class="row">
              <div class="col-lg-8 mb-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-area me-2"></i>
                      Daily Revenue Trend
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="revenueChart" height="100"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 mb-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-pie me-2"></i>
                      Revenue by Category
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="categoryChart" height="250"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Row -->
    <div class="row">
      <!-- Recent Orders -->
      <div class="col-lg-6 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="fas fa-shopping-cart me-2"></i>
              Recent Orders
            </h6>
            <%= link_to admin_orders_path, class: "btn btn-sm btn-primary" do %>
              View All
            <% end %>
          </div>
          <div class="card-body" style="max-height: 400px; overflow-y: auto;">
            <% if @recent_orders&.any? %>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Order #</th>
                      <th>Customer</th>
                      <th>Status</th>
                      <th>Amount</th>
                      <th>Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @recent_orders.each do |order| %>
                      <tr>
                        <td>
                          <strong>
                            <%= link_to order.order_number || "##{order.id}", admin_order_path(order), class: "text-decoration-none" %>
                          </strong>
                        </td>
                        <td>
                          <%= order.user&.email || 'N/A' %><br>
                          <small class="text-muted"><%= order.user&.full_name || 'N/A' %></small>
                        </td>
                        <td>
                          <span class="badge bg-<%= case order.status
                            when 'delivered' then 'success'
                            when 'shipped', 'paid' then 'info'
                            when 'pending' then 'warning'
                            when 'cancelled' then 'danger'
                            else 'secondary'
                            end %>">
                            <%= order.status&.titleize || 'N/A' %>
                          </span>
                        </td>
                        <td><strong>₹<%= number_with_delimiter(order.total_amount || 0) %></strong></td>
                        <td><%= order.created_at.strftime('%b %d, %Y') %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <div class="text-center py-4">
                <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                <p class="text-muted">No orders found.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Recent Users -->
      <div class="col-lg-6 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="fas fa-users me-2"></i>
              Recent Users
            </h6>
            <a href="/admin/user" class="btn btn-sm btn-primary" target="_blank">View All</a>
          </div>
          <div class="card-body" style="max-height: 400px; overflow-y: auto;">
            <% if @recent_users&.any? %>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Role</th>
                      <th>Joined</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @recent_users.each do |user| %>
                      <tr>
                        <td><strong><%= user.first_name %> <%= user.last_name %></strong></td>
                        <td><%= user.email %></td>
                        <td>
                          <span class="badge bg-info">
                            <%= user.role&.titleize || 'Customer' %>
                          </span>
                        </td>
                        <td><%= user.created_at.strftime("%b %d, %Y") %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <div class="text-center py-4">
                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                <p class="text-muted">No users found.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Phase 2: Recent Products Row -->
    <div class="row">
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="fas fa-box me-2"></i>
              Recent Products
            </h6>
            <%= link_to admin_products_path, class: "btn btn-sm btn-primary" do %>
              View All
            <% end %>
          </div>
          <div class="card-body" style="max-height: 400px; overflow-y: auto;">
            <% if @recent_products&.any? %>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Brand</th>
                      <th>Status</th>
                      <th>Stock</th>
                      <th>Flags</th>
                      <th>Created</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @recent_products.each do |product| %>
                      <tr>
                        <td>
                          <strong>
                            <%= link_to product.name, admin_product_path(product), class: "text-decoration-none" %>
                          </strong>
                        </td>
                        <td><%= product.category&.name || 'N/A' %></td>
                        <td><%= product.brand&.name || 'N/A' %></td>
                        <td>
                          <span class="badge bg-<%= product.status == 'active' ? 'success' : product.status == 'pending' ? 'warning' : 'danger' %>">
                            <%= product.status&.titleize || 'N/A' %>
                          </span>
                        </td>
                        <td>
                          <%= product.total_stock_quantity || 0 %>
                          <% if product.low_stock_variants_count && product.low_stock_variants_count > 0 %>
                            <span class="badge bg-warning text-dark" title="Low stock variants">
                              <%= product.low_stock_variants_count %>
                            </span>
                          <% end %>
                        </td>
                        <td>
                          <% if product.is_featured %><span class="badge bg-primary">Featured</span><% end %>
                          <% if product.is_bestseller %><span class="badge bg-success">Bestseller</span><% end %>
                          <% if product.is_new_arrival %><span class="badge bg-info">New</span><% end %>
                          <% if product.is_trending %><span class="badge bg-danger">Trending</span><% end %>
                        </td>
                        <td><%= product.created_at.strftime("%b %d, %Y") %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <div class="text-center py-4">
                <i class="fas fa-box fa-3x text-muted mb-3"></i>
                <p class="text-muted">No products found.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fas fa-bolt me-2"></i>
              Quick Actions
            </h6>
          </div>
          <div class="card-body">
            <div class="row quick-actions">
              <div class="col-md-3 col-sm-6">
            <%= link_to admin_users_path, class: "btn btn-primary w-100" do %>
              <i class="fas fa-users"></i>
              Manage Users
            <% end %>
          </div>
          <div class="col-md-3 col-sm-6">
            <%= link_to admin_suppliers_path, class: "btn btn-success w-100" do %>
              <i class="fas fa-store"></i>
              Manage Suppliers
            <% end %>
          </div>
          <div class="col-md-3 col-sm-6">
            <%= link_to admin_products_path, class: "btn btn-info w-100" do %>
              <i class="fas fa-box"></i>
              Manage Products
            <% end %>
          </div>
          <div class="col-md-3 col-sm-6">
            <%= link_to admin_orders_path, class: "btn btn-warning w-100" do %>
              <i class="fas fa-shopping-cart"></i>
              Manage Orders
            <% end %>
          </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container">
    <% if notice %>
      <div class="toast toast-success" id="toast-notice" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
        <div class="toast-header">
          <i class="fas fa-check-circle text-success me-2"></i>
          <strong class="me-auto">Success</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
          <%= notice %>
        </div>
      </div>
    <% end %>
    
    <% if alert %>
      <div class="toast toast-danger" id="toast-alert" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
        <div class="toast-header">
          <i class="fas fa-exclamation-circle text-danger me-2"></i>
          <strong class="me-auto">Error</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
          <%= alert %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
  // Chart data from server
  const dailyRevenueData = <%= @daily_revenue.to_json.html_safe %>;
  const revenueByCategoryData = <%= @revenue_by_category.to_json.html_safe %>;
  
  // Initialize Revenue Trend Chart
  document.addEventListener('DOMContentLoaded', function() {
    const revenueCtx = document.getElementById('revenueChart');
    if (revenueCtx && dailyRevenueData && dailyRevenueData.length > 0) {
      const labels = dailyRevenueData.map(item => {
        const date = new Date(item.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
      const revenues = dailyRevenueData.map(item => item.revenue);
      
      new Chart(revenueCtx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Revenue (₹)',
            data: revenues,
            borderColor: 'rgb(102, 126, 234)',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'Revenue: ₹' + context.parsed.y.toLocaleString('en-IN');
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '₹' + value.toLocaleString('en-IN');
                }
              }
            }
          }
        }
      });
    }
    
    // Initialize Category Revenue Chart
    const categoryCtx = document.getElementById('categoryChart');
    if (categoryCtx && revenueByCategoryData && revenueByCategoryData.length > 0) {
      const categoryLabels = revenueByCategoryData.map(item => item.category_name);
      const categoryRevenues = revenueByCategoryData.map(item => item.revenue);
      
      // Generate colors for pie chart
      const colors = [
        'rgba(102, 126, 234, 0.8)',
        'rgba(118, 75, 162, 0.8)',
        'rgba(240, 147, 251, 0.8)',
        'rgba(245, 87, 108, 0.8)',
        'rgba(79, 172, 254, 0.8)',
        'rgba(0, 242, 254, 0.8)',
        'rgba(255, 193, 7, 0.8)',
        'rgba(40, 167, 69, 0.8)'
      ];
      
      new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
          labels: categoryLabels,
          datasets: [{
            data: categoryRevenues,
            backgroundColor: colors.slice(0, categoryLabels.length),
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return label + ': ₹' + value.toLocaleString('en-IN') + ' (' + percentage + '%)';
                }
              }
            }
          }
        }
      });
    }
    
    // Initialize and show toasts with auto-hide
    const toasts = document.querySelectorAll('.toast');
    toasts.forEach(function(toastElement) {
      const bsToast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
      });
      
      // Remove toast from DOM after it's hidden
      toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
      });
      
      bsToast.show();
    });
    
    // Admin Search Functionality
    const searchInput = document.getElementById('admin-search-input');
    const searchForm = document.getElementById('admin-search-form');
    const searchResults = document.getElementById('search-results');
    const searchResultsContent = document.getElementById('search-results-content');
    let searchTimeout;
    
    if (searchInput && searchForm) {
      // Handle input with debounce
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();
        
        clearTimeout(searchTimeout);
        
        if (query.length < 2) {
          searchResults.style.display = 'none';
          return;
        }
        
        searchTimeout = setTimeout(function() {
          performSearch(query);
        }, 300);
      });
      
      // Handle form submission
      searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (query.length >= 2) {
          performSearch(query);
        }
      });
      
      // Hide results when clicking outside
      document.addEventListener('click', function(e) {
        if (!searchForm.contains(e.target)) {
          searchResults.style.display = 'none';
        }
      });
    }
    
    function performSearch(query) {
      if (!query || query.length < 2) return;
      
      // Show loading state
      searchResultsContent.innerHTML = '<div class="p-3 text-center"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';
      searchResults.style.display = 'block';
      
      // Make API call
      fetch(`/api/v1/admin/search?q=${encodeURIComponent(query)}`, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]')?.content || ''
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          displaySearchResults(data.data);
        } else {
          searchResultsContent.innerHTML = '<div class="p-3 text-muted">No results found</div>';
        }
      })
      .catch(error => {
        console.error('Search error:', error);
        searchResultsContent.innerHTML = '<div class="p-3 text-danger">Error performing search</div>';
      });
    }
    
    function displaySearchResults(results) {
      const allResults = [
        ...results.users.map(r => ({...r, icon: 'fa-user', color: 'primary'})),
        ...results.orders.map(r => ({...r, icon: 'fa-shopping-cart', color: 'info'})),
        ...results.products.map(r => ({...r, icon: 'fa-box', color: 'success'})),
        ...results.suppliers.map(r => ({...r, icon: 'fa-store', color: 'warning'}))
      ];
      
      if (allResults.length === 0) {
        searchResultsContent.innerHTML = '<div class="p-3 text-muted">No results found</div>';
        return;
      }
      
      let html = '';
      allResults.forEach(result => {
        html += `
          <a href="${result.url}" class="dropdown-item d-flex align-items-center">
            <i class="fas ${result.icon} text-${result.color} me-2"></i>
            <div class="flex-grow-1">
              <div class="fw-bold">${result.title}</div>
              <small class="text-muted">${result.subtitle}</small>
            </div>
          </a>
        `;
      });
      
      searchResultsContent.innerHTML = html;
    }
  });
  </script>
</body>
</html>